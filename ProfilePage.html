<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Synapse - Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Inter:wght@400;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="css/profile.css">
</head>

<body>
  <!-- Curved blobs -->
  <div class="blob blob1"></div>
  <div class="blob blob2"></div>
  <div class="blob blob3"></div>
  <div class="blob blob4"></div>
  <div class="circle-top-right"></div>

  <div class="profile-card">
    <h2 class="profile-title">Your <span>Profile</span></h2>

    <!-- Profile Picture -->
    <div class="profile-pic-wrapper">
      <img src="images/pplogo.jpg" alt="Profile Picture" id="preview" class="profile-pic">
      <input type="file" id="profile-pic" accept="image/*" class="profile-pic-input">
      <label for="profile-pic" class="edit-icon">
        <img src="images/pencillogo.jpg" alt="Edit">
      </label>
    </div>

    <form id="profileForm" novalidate>
      <div class="input-field">
        <label for="fullname">Full Name</label>
        <input type="text" id="fullname" required pattern="^[A-Za-z ]{3,50}$" placeholder="John Doe">
        <div class="error-message">Enter a valid full name (letters & spaces, 3â€“50 chars).</div>
      </div>

      <div class="input-field">
        <label for="email">Email</label>
        <input type="email" id="email" required placeholder="name@example.com" readonly>
        <div class="error-message">Enter a valid email address.</div>
      </div>

      <div class="input-field">
        <label for="dob">Date of Birth</label>
        <input type="date" id="dob" required>
        <div class="error-message">Please select a valid date of birth.</div>
      </div>

      <div class="input-field">
        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" required pattern="^[0-9]{10}$" placeholder="9876543210">
        <div class="error-message">Enter a valid 10-digit phone number.</div>
      </div>

      <div class="input-field">
        <label for="location">Location</label>
        <input type="text" id="location" required placeholder="City, Country">
        <div class="error-message">Enter a valid location.</div>
      </div>

      <div class="input-field">
        <label for="bio">Bio</label>
        <textarea id="bio" rows="3" maxlength="200" placeholder="Tell us about yourself..."></textarea>
      </div>

      <div class="input-field">
        <label for="skills">Skills</label>
        <textarea id="skills" rows="2" placeholder="E.g., Python, Design, Leadership"></textarea>
      </div>

      <div class="input-field">
        <label for="achievements">Achievements</label>
        <textarea id="achievements" rows="2" placeholder="E.g., Hackathon Winner, Published Paper"></textarea>
      </div>

      <div class="input-field">
        <label for="teams">Previous Teams</label>
        <textarea id="teams" rows="2" placeholder="E.g., Robotics Club, Startup X"></textarea>
      </div>

      <div class="input-field">
        <label for="experience">Experience</label>
        <textarea id="experience" rows="3" placeholder="E.g., 2 years as Web Developer"></textarea>
      </div>

      <button type="submit" class="save-btn">Save Profile</button>
    </form>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // âœ… Firebase CDN imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ðŸ”‘ Your Firebase config (replace with your web app credentials)
    const firebaseConfig = {
      apiKey: "AIzaSyCJdzL6hBxD2JwsXdb2QD6rhJK_MIlFfdg",
      authDomain: "synapse-ee716.firebaseapp.com",
      projectId: "synapse-ee716",
      storageBucket: "synapse-ee716.appspot.com",
      messagingSenderId: "894940754670",
      appId: "1:894940754670:web:88cedd500b4dca5dc9f9ff",
      measurementId: "G-PW7HGF2LTE"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const profileForm = document.getElementById("profileForm");

    // âœ… Check if user is logged in and fetch profile data
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "/login_Page.html";
      } else {
        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          document.getElementById("fullname").value = data.firstName + " " + data.lastName;
          document.getElementById("email").value = data.email;
          document.getElementById("dob").value = data.dob || "";
          document.getElementById("phone").value = data.phone || "";
          document.getElementById("location").value = data.location || "";
          document.getElementById("bio").value = data.bio || "";
          document.getElementById("skills").value = data.skills || "";
          document.getElementById("achievements").value = data.achievements || "";
          document.getElementById("teams").value = data.teams || "";
          document.getElementById("experience").value = data.experience || "";
        }
      }
    });

    // âœ… Save profile data to Firestore
    profileForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return;

      const fullname = document.getElementById("fullname").value.trim();
      const [firstName, ...lastNameArr] = fullname.split(" ");
      const lastName = lastNameArr.join(" ");

      const profileData = {
        firstName,
        lastName,
        email: document.getElementById("email").value.trim(),
        dob: document.getElementById("dob").value,
        phone: document.getElementById("phone").value.trim(),
        location: document.getElementById("location").value.trim(),
        bio: document.getElementById("bio").value.trim(),
        skills: document.getElementById("skills").value.trim(),
        achievements: document.getElementById("achievements").value.trim(),
        teams: document.getElementById("teams").value.trim(),
        experience: document.getElementById("experience").value.trim()
      };

      try {
        await setDoc(doc(db, "users", user.uid), profileData, { merge: true });
        alert("Profile saved successfully! ðŸŽ‰");
      } catch (err) {
        alert("Error saving profile: " + err.message);
      }
    });
  </script>
</body>

</html>
